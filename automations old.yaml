- alias: Monitor Traffic

  trigger:
    platform: state
    entity_id: sensor.snmp_wan_in

  action:
    - service: input_slider.select_value
      data_template:
        entity_id: input_slider.internet_traffic_delta_in
        value: '{{ ((trigger.to_state.state | int - trigger.from_state.state | int) * 1 ) / ( as_timestamp(trigger.to_state.last_updated) - as_timestamp(trigger.from_state.last_updated) ) }}'

- alias: Monitor Traffic

  trigger:
    platform: state
    entity_id: sensor.snmp_wan_out

  action:
    - service: input_slider.select_value
      data_template:
        entity_id: input_slider.internet_traffic_delta_out
        value: '{{ ((trigger.to_state.state | int - trigger.from_state.state | int) * 1 ) / ( as_timestamp(trigger.to_state.last_updated) - as_timestamp(trigger.from_state.last_updated) ) }}'

- alias: Monitor Traffic Lan Traffic

  trigger:
    platform: state
    entity_id: sensor.snmp_lan_load_in

  action:
    - service: input_slider.select_value
      data_template:
        entity_id: input_slider.lan_load_delta_in
        value: '{{ ((trigger.to_state.state | int - trigger.from_state.state | int) * 1 ) / ( as_timestamp(trigger.to_state.last_updated) - as_timestamp(trigger.from_state.last_updated) ) }}'   
        
- alias: Monitor Traffic Lan Traffic

  trigger:
    platform: state
    entity_id: sensor.snmp_lan_load_out

  action:
    - service: input_slider.select_value
      data_template:
        entity_id: input_slider.lan_load_delta_out
        value: '{{ ((trigger.to_state.state | int - trigger.from_state.state | int) * 1 ) / ( as_timestamp(trigger.to_state.last_updated) - as_timestamp(trigger.from_state.last_updated) ) }}'      
                


   

######################################################

######################################################
# Washer timer automation
#######################################################    
- alias: Washer Completes Wash
  trigger:
    - platform: state
      entity_id: sensor.washer_status
      to: 'running'
      for:
        minutes: 36
  action:
    - service: tts.google_say
      data:
        entity_id: media_player.kodi_blue_iris
        message: 'Washer is Finished'
    - service: input_select.select_option
      data:
        entity_id: input_select.washing_machine_status
        option: 'clean'
        

############################# Sets Logging Level 
- alias: Log Level
  trigger:
    - platform: state
      entity_id: input_select.log_level
  action:
    - service: logger.set_level
      data_template:
        homeassistant.components: "{{ trigger.to_state.state }}"
        
################### Porch lights on at night  ###########################
- alias: Porch Lights on
  trigger:
    - platform: sun
      event: sunset
#      offset: "00:30:00"
  action:
    - service: light.turn_on
      entity_id: light.carport
- alias: Porch Lights off
  trigger:
    - platform: sun
      event: sunrise
#      offset: "-00:30:00"
  action:
    - service: light.turn_off
      entity_id: light.carport     


############ auto renew ssl   with notification if fails ####################
- alias: Auto Renew SSL Cert
  trigger:
    - platform: numeric_state
      entity_id: sensor.ssl_expire
      below: 29
  action:
    - service: shell_command.renew_ssl 

- alias: 'SSL expiry notification'
  trigger:
    - platform: numeric_state
      entity_id: sensor.ssl_expire
      below: 21
  action:
    - service: notify.Pushbullet
      data:
        message: 'Warning - SSL certificate expires in 21 days and has not been automatically renewed'    